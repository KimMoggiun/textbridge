<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 11, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2764 | 2:05 AM | ğŸ”µ | Single Character Test Shows IME Back in Korean Mode After Successful Tests | ~407 |
| #2763 | 2:00 AM | ğŸ”´ | HID Log Confirms Three Korean Texts with Proper Toggle Sequences | ~505 |
| #2761 | 1:58 AM | ğŸ”´ | Ctrl+Space Toggle Successfully Injected with Control Modifier - IME Switches to English | ~482 |
| #2759 | 1:55 AM | ğŸ”µ | HID Log Shows Korean Characters for ASCII Test Input | ~391 |
| #2757 | 1:52 AM | ğŸ”µ | Log Shows Korean Jamo Characters Mixed with English, Confirming IME Not Switching | ~453 |
| #2756 | " | ğŸ”µ | Critical Finding: Zero Ctrl+Space Toggle Events in HID Log | ~447 |
| #2755 | 1:51 AM | ğŸ”µ | Right Arrow Key Events Captured in HID Log | ~418 |
| #2754 | " | ğŸ”µ | HID Log Shows Control Modifier Present for Ctrl+C but Not for Space | ~392 |
| #2752 | 1:50 AM | âœ… | Add Right Arrow Before Toggle Keys to Commit IME Composition | ~478 |
| #2750 | " | ğŸ”µ | Flutter Test Suite Passes 72/72 Tests with Fresh JSON Export | ~559 |
| #2742 | 1:48 AM | ğŸ”µ | Complete Test Suite Architecture and Execution Flow | ~755 |
| #2741 | 1:47 AM | ğŸ”µ | HID Logger Output Reveals Korean Input Mode Issues | ~429 |
| #2740 | " | ğŸ”µ | Bluetooth Cache Reset Utility for GATT Issues | ~305 |
| #2739 | 1:46 AM | ğŸ”µ | TextBridge Pairing Mode Automation Tool | ~348 |
| #2738 | " | ğŸ”µ | DFU Mode Entry Tool for Firmware Updates | ~328 |
| #2737 | " | ğŸ”µ | Phase 2 BLE GATT Connectivity Test | ~441 |
| #2736 | " | ğŸ”µ | App-Firmware Bridge Test Architecture | ~481 |
| #2735 | " | ğŸ”µ | Phase 5 Hangul Test Suite Structure | ~396 |
| #2734 | 1:45 AM | ğŸ”µ | TextBridge Protocol Implementation with Korean Input Support | ~553 |
| #2732 | " | ğŸ”µ | HID Logger Tool for Keyboard Event Debugging | ~351 |
</claude-mem-context>

# TextBridge Tools

Keychron B6 Pro (nRF52840) íŒì›¨ì–´ ë¹Œë“œ, í”Œë˜ì‹œ, í…ŒìŠ¤íŠ¸ ë„êµ¬ ëª¨ìŒ.

## ì˜ì¡´ì„±

```bash
pip install hidapi bleak
```

- `hidapi`: USB Raw HID í†µì‹  (enter_dfu.py, tb_pair.py)
- `bleak`: BLE GATT í†µì‹  (ëª¨ë“  í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸)

ëª¨ë“  BLE í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ì— VIA í˜ì–´ë§(0xFE)ì´ ë‚´ì¥ë˜ì–´ ìˆë‹¤.

## ë¹Œë“œ

```bash
source ~/.zmk_env/bin/activate && \
export ZEPHYR_SDK_INSTALL_DIR=~/.zephyr-sdk-0.16.3 && \
cd ~/project/textbridge/zmk_keychron/app && \
west build --pristine -b keychron -- -DSHIELD=keychron_b6_us
```

ì¶œë ¥: `build/zephyr/zmk.uf2` (FLASH 25%, SRAM 33%)

`--pristine` ìƒëµí•˜ë©´ ì¦ë¶„ ë¹Œë“œ (ë³€ê²½ íŒŒì¼ë§Œ ì¬ì»´íŒŒì¼).

## DFU ì§„ì… + í”Œë˜ì‹œ

```bash
python3 enter_dfu.py && sleep 3 && cp ~/project/textbridge/zmk_keychron/app/build/zephyr/zmk.uf2 /Volumes/NRF52BOOT/
```

ìˆ˜ë™ DFU: í‚¤ë³´ë“œ ESC ëˆ„ë¥¸ ì±„ USB ì—°ê²°.

## í…ìŠ¤íŠ¸ ì „ì†¡ (test_phase3_protocol.py)

VIA í˜ì–´ë§ â†’ BLE ìŠ¤ìº” â†’ ì—°ê²° â†’ í‚¤ì½”ë“œ ì „ì†¡ â†’ Enter. ëª¨ë‘ ìë™. macOS(Ctrl+Space í† ê¸€) ê³ ì •.

```bash
python3 test_phase3_protocol.py --text "hello"
python3 test_phase3_protocol.py --text "Hello ì•ˆë…• World"
```

ì¶œë ¥:

```
pairing... ok
scanning... 7B2890F5-B71F-CC2C-0CC1-C9A378436B0B
sending... ok
```

## í•œê¸€ ì „ì†¡ í…ŒìŠ¤íŠ¸ (test_phase5_hangul.py)

ì‚¬ì „ ì •ì˜ëœ í•œê¸€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ìˆœì„œëŒ€ë¡œ ì „ì†¡. ê° í…ìŠ¤íŠ¸ë§ˆë‹¤ Enter í¬í•¨.

```bash
python3 test_phase5_hangul.py --test pure        # ìˆœìˆ˜ í•œê¸€ (ì•ˆë…•í•˜ì„¸ìš”, ëŒ€í•œë¯¼êµ­, í”„ë¡œê·¸ë˜ë°)
python3 test_phase5_hangul.py --test mixed       # í•œì˜ í˜¼í•©
python3 test_phase5_hangul.py --test complex     # ìŒììŒ/ê²¹ë°›ì¹¨ (ê¹Œë‹­ì—†ì´, ì™•ê´€, ê°’ì‹¼, ì½ë‹¤, ì•‰ë‹¤)
python3 test_phase5_hangul.py --test all         # ì „ì²´
```

ì¶œë ¥:

```
pairing... ok
scanning... 7B2890F5-B71F-CC2C-0CC1-C9A378436B0B
ì•ˆë…•í•˜ì„¸ìš”... ok
ëŒ€í•œë¯¼êµ­... ok
```

## Dart-Python í‚¤ì½”ë“œ ë¹„êµ (test_app_bridge.py)

```bash
python3 test_app_bridge.py --compare all         # ì˜¤í”„ë¼ì¸ ë¹„êµ (BLE ë¶ˆí•„ìš”, 12/12 MATCH)
python3 test_app_bridge.py --test all            # BLE ì „ì†¡ í…ŒìŠ¤íŠ¸ (macOSì—ì„œ: Windows+í•œê¸€ ì¼€ì´ìŠ¤ ìë™ ì œì™¸, 6/6)
```

`--test all`ì€ macOSì—ì„œ ì‹¤í–‰ ì‹œ Windows í† ê¸€(LANG1)ì´ í•„ìš”í•œ í•œê¸€ ì¼€ì´ìŠ¤ë¥¼ ìë™ ì œì™¸í•œë‹¤. ASCII 3ê°œ + macOS í•œê¸€ 3ê°œ = 6ê°œë§Œ BLEë¡œ ì „ì†¡.

## ê¸°íƒ€ ë„êµ¬

| ë„êµ¬ | ì„¤ëª… |
|------|------|
| `enter_dfu.py` | VIA Raw HIDë¡œ DFU ë¶€íŠ¸ë¡œë” ì§„ì… |
| `tb_pair.py` | VIA Raw HIDë¡œ BLE ê´‘ê³  ì‹œì‘ (ë””ë²„ê¹…ìš©) |
| `test_phase2_ble.py` | BLE GATT ì—°ê²°/ì„œë¹„ìŠ¤/íŠ¹ì„± í…ŒìŠ¤íŠ¸ |

## HID ì¶œë ¥ ê²€ì¦ ë°©ë²• (Claude Code í„°ë¯¸ë„ í™œìš©)

### ê°œìš”

í‚¤ë³´ë“œ íŒì›¨ì–´ê°€ USB HIDë¡œ ì£¼ì…í•˜ëŠ” í…ìŠ¤íŠ¸ê°€ ì˜¬ë°”ë¥¸ì§€ ê²€ì¦í•˜ëŠ” ë°©ë²•.
pynput(macOS Accessibility ê¶Œí•œ í•„ìš”)ì´ë‚˜ clipboard ì¡°ì‘ ì—†ì´, **Claude Code ìì²´ë¥¼ ê²€ì¦ê¸°**ë¡œ ì‚¬ìš©í•œë‹¤.

### ë™ì‘ ì›ë¦¬

TextBridge í‚¤ë³´ë“œëŠ” USB HID í‚¤ë³´ë“œë‹¤. í‚¤ì½”ë“œë¥¼ ì£¼ì…í•˜ë©´ macOSê°€ **í˜„ì¬ ì»¤ì„œ í¬ì»¤ìŠ¤ê°€ ìˆëŠ” ì•±**ì— í‚¤ ì…ë ¥ì„ ì „ë‹¬í•œë‹¤.

```
Python ìŠ¤í¬ë¦½íŠ¸ â†’(BLE)â†’ í‚¤ë³´ë“œ íŒì›¨ì–´ â†’(USB HID)â†’ macOS â†’(í‚¤ ì…ë ¥)â†’ í¬ì»¤ìŠ¤ëœ ì•±
```

ì‚¬ìš©ìê°€ **Claude Code í„°ë¯¸ë„ ì…ë ¥ì°½ì— ì»¤ì„œë¥¼ ë‘” ìƒíƒœ**ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´,
HID ì£¼ì…ëœ ë¬¸ìë“¤ì´ Claude Code ì…ë ¥ì°½ì— íƒ€ì´í•‘ëœë‹¤.
í…ìŠ¤íŠ¸ ëì— **Enter í‚¤ì½”ë“œ(HID 0x28)**ë¥¼ ë³´ë‚´ë©´, Claude Codeì— **ì‚¬ìš©ì ë©”ì‹œì§€ë¡œ ì œì¶œ**ëœë‹¤.

### Claude Codeê°€ ìˆ˜í–‰í•  ê²€ì¦ ì ˆì°¨

1. **ì˜ˆìƒ í…ìŠ¤íŠ¸ë¥¼ ê¸°ì–µí•œë‹¤** â€” Python ìŠ¤í¬ë¦½íŠ¸ê°€ ë³´ë‚¼ í…ìŠ¤íŠ¸ë¥¼ ë¯¸ë¦¬ ì•Œê³  ìˆì–´ì•¼ í•œë‹¤
2. **Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰í•œë‹¤** â€” Bash ë„êµ¬ì˜ `run_in_background` ì‚¬ìš©
   ```bash
   # ë‹¨ì¼ í…ìŠ¤íŠ¸ ê²€ì¦
   python3 test_phase3_protocol.py --text "hello"
   # í•œê¸€ ê·¸ë£¹ ê²€ì¦
   python3 test_phase5_hangul.py --test pure
   ```
   - ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ëŠ” í…ìŠ¤íŠ¸ ëì— Enter(0x28)ë¥¼ ìë™ ì¶”ê°€í•œë‹¤
3. **ë‹¤ìŒ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ê¸°ë‹¤ë¦°ë‹¤** â€” HID ì£¼ì…ì´ ì™„ë£Œë˜ë©´ Enterì— ì˜í•´ ìë™ ì œì¶œëœë‹¤
   - ì´ ë©”ì‹œì§€ì˜ ë‚´ìš©ì´ ê³§ í‚¤ë³´ë“œê°€ ì‹¤ì œë¡œ ì¶œë ¥í•œ í…ìŠ¤íŠ¸ì´ë‹¤
4. **ìˆ˜ì‹ í•œ ë©”ì‹œì§€ vs ì˜ˆìƒ í…ìŠ¤íŠ¸ë¥¼ ë¹„êµí•œë‹¤** â€” ì¼ì¹˜í•˜ë©´ PASS, ë¶ˆì¼ì¹˜ë©´ FAIL + diff ì¶œë ¥

### ì „ì œ ì¡°ê±´

- **macOS ì…ë ¥ ì†ŒìŠ¤ê°€ ì˜ë¬¸(ABC)** ìƒíƒœì—ì„œ ì‹œì‘í•´ì•¼ í•œë‹¤. ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” ì‹œìŠ¤í…œ ì´ˆê¸° ì…ë ¥ì´ ì˜ì–´ë¼ê³  ê°€ì •í•œë‹¤.
- í•œê¸€ í…ìŠ¤íŠ¸ê°€ ì‹œì‘ë˜ë©´ `hangul_to_keycodes`ê°€ ìë™ìœ¼ë¡œ Ctrl+Space í† ê¸€í‚¤ë¥¼ ì‚½ì…í•˜ì—¬ í•œê¸€ ì…ë ¥ìœ¼ë¡œ ì „í™˜í•œë‹¤.
- `hangul_to_keycodes`ëŠ” í…ìŠ¤íŠ¸ ëì´ í•œê¸€ì´ë©´ ìë™ìœ¼ë¡œ trailing toggleì„ ì¶”ê°€í•˜ì—¬ ì˜ë¬¸ìœ¼ë¡œ ë³µê·€í•œë‹¤. ë”°ë¼ì„œ ë§¤ ì „ì†¡ í›„ ì‹œìŠ¤í…œì€ ì˜ë¬¸ ìƒíƒœë¡œ ëŒì•„ì˜¨ë‹¤.
- ì°¸ê³ : Dart ì•±ì˜ `textToKeycodes`ëŠ” trailing toggleì„ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤ (`endsInKorean` í”Œë˜ê·¸ë¡œ ë³„ë„ ì²˜ë¦¬). `test_app_bridge.py`ëŠ” Dart í‚¤ì½”ë“œ ì‚¬ìš© ì‹œ `ends_in_korean` í”Œë˜ê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë³„ë„ ì„¸ì…˜ìœ¼ë¡œ trailing toggleì„ ì „ì†¡í•œë‹¤.
- ì‚¬ìš©ìê°€ Claude Code í„°ë¯¸ë„ ì…ë ¥ì°½ì— ì»¤ì„œ í¬ì»¤ìŠ¤ë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤
- í…ŒìŠ¤íŠ¸ ë„ì¤‘ ì‚¬ìš©ìê°€ ì§ì ‘ íƒ€ì´í•‘í•˜ë©´ ê²€ì¦ì´ ê¹¨ì§„ë‹¤

## ì£¼ì˜ì‚¬í•­

- **macOS BLE GATT ìºì‹œ**: íŒì›¨ì–´ ë¦¬í”Œë˜ì‹œ ë˜ëŠ” ë¹„ì •ìƒ BLE í•´ì œ í›„ macOSê°€ CCC ìƒíƒœë¥¼ ìºì‹±í•˜ì—¬ `tb_notify_enabled`ê°€ falseë¡œ ë‚¨ì„ ìˆ˜ ìˆìŒ. í•´ê²°: macOS Bluetooth ë„ê³  ì¼œê¸°.
- **í‚¤ë³´ë“œ ì „ì› ë¦¬ì…‹**: ë°°í„°ë¦¬ê°€ ìˆì–´ USB ì¬ì—°ê²°ë§Œìœ¼ë¡  íŒì›¨ì–´ ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ. ë’·ë©´ ì „ì› ìŠ¤ìœ„ì¹˜ OFF â†’ 5ì´ˆ â†’ ON.
- **ì‹¤í–‰ ë””ë ‰í„°ë¦¬**: ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ëŠ” `tools/` ë””ë ‰í„°ë¦¬ì—ì„œ ì‹¤í–‰. `cd tools && python3 <script>.py`
- **macOS Carbon API ì œí•œ**: `TISCopyCurrentKeyboardInputSource()`ëŠ” í˜¸ì¶œ í”„ë¡œì„¸ìŠ¤ì˜ ì…ë ¥ ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. ë°±ê·¸ë¼ìš´ë“œ Pythonì—ì„œ í˜¸ì¶œí•˜ë©´ í¬ì»¤ìŠ¤ëœ ì•±(Claude Code)ì˜ ì…ë ¥ ì†ŒìŠ¤ê°€ ì•„ë‹Œ Python í”„ë¡œì„¸ìŠ¤ì˜ ì…ë ¥ ì†ŒìŠ¤(í•­ìƒ ABC)ê°€ ë°˜í™˜ëœë‹¤. ì…ë ¥ ì†ŒìŠ¤ ê°ì§€ì— ì‚¬ìš© ë¶ˆê°€.

## ì‹œë¦¬ì–¼ ë¡œê·¸

```bash
screen /dev/tty.usbmodem* 115200
```
